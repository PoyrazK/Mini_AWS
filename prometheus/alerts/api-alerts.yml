groups:
  - name: thecloud-api-alerts
    rules:
      - alert: HighAPIErrorRate
        expr: (sum(rate(thecloud_http_requests_total{status=~"5.."}[5m])) / sum(rate(thecloud_http_requests_total[5m]))) > 0.1
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "High API Error Rate (>10%)"
          description: "API is returning errors for more than 10% of requests over the last 5 minutes."

      - alert: HighAPILatency
        expr: histogram_quantile(0.95, sum(rate(thecloud_http_request_duration_seconds_bucket[5m])) by (le)) > 2
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High API Latency (p95 > 2s)"
          description: "API 95th percentile latency is above 2 seconds for 5 minutes."

      - alert: InstanceErrorStatus
        expr: thecloud_instances_total{status="error"} > 0
        for: 1m
        labels:
          severity: warning
        annotations:
          summary: "Instances in Error State"
          description: "One or more instances are in an error state."
